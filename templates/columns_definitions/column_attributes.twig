{# Cell index: If certain fields get left out, the counter shouldn't change. #}
{% set ci = 0 %}

{# Every time a cell shall be left out the STRG-jumping feature, $ci_offset has
   to be incremented ($ci_offset++) #}
{% set ci_offset = -1 %}

<td class="center">
    {# column name #}
    {% set ci = ci + 1 %}
    {% include 'columns_definitions/column_name.twig' with {
        'column_number': column_number,
        'ci': ci,
        'ci_offset': ci_offset,
        'column_meta': column_meta,
        'cfg_relation': cfg_relation,
        'max_rows': max_rows
    } only %}
</td>
<td class="center">
    {# column type #}
    {% set ci = ci + 1 %}
    {% include 'columns_definitions/column_type.twig' with {
        'column_number': column_number,
        'ci': ci,
        'ci_offset': ci_offset,
        'column_meta': column_meta,
        'type_upper': type_upper
    } only %}
</td>
<td class="center">
    {# column length #}
    {% set ci = ci + 1 %}
    {% include 'columns_definitions/column_length.twig' with {
        'column_number': column_number,
        'ci': ci,
        'ci_offset': ci_offset,
        'length_values_input_size': length_values_input_size,
        'length_to_display': length_to_display
    } only %}
</td>
<td class="center">
    {# column default #}
    {% set ci = ci + 1 %}
    {% include 'columns_definitions/column_default.twig' with {
        'column_number': column_number,
        'ci': ci,
        'ci_offset': ci_offset,
        'column_meta': column_meta,
        'type_upper': type_upper,
        'char_editing': char_editing
    } only %}
</td>
<td class="center">
    {# column collation #}
    {{ Charsets_getCollationDropdownBox(
        'field_collation[' ~ column_number ~ ']',
        'field_' ~ column_number ~ '_' ~ (ci - ci_offset),
        column_meta['Collation'] is not empty ? column_meta['Collation'] : null,
        false
    ) }}
</td>
<td class="center">
    {# column attribute #}
    {% set ci = ci + 1 %}
    {% include 'columns_definitions/column_attribute.twig' with {
        'column_number': column_number,
        'ci': ci,
        'ci_offset': ci_offset,
        'column_meta': column_meta,
        'extracted_columnspec': extracted_columnspec,
        'submit_attribute': submit_attribute,
        'attribute_types': attribute_types
    } only %}
</td>
<td class="center">
    {# column NULL #}
    {% set ci = ci + 1 %}
    {% include 'columns_definitions/column_null.twig' with {
        'column_number': column_number,
        'ci': ci,
        'ci_offset': ci_offset,
        'column_meta': column_meta
    } only %}
</td>
{% if change_column is defined and change_column is not empty %}
    {# column Adjust privileges, Only for 'Edit' Column(s) #}
    <td class="center">
        {% set ci = ci + 1 %}
        {% include 'columns_definitions/column_adjust_privileges.twig' with {
            'column_number': column_number,
            'ci': ci,
            'ci_offset': ci_offset,
            'privs_available': privs_available
        } only %}
    </td>
{% endif %}
{% if not is_backup %}
    {# column indexes, See my other comment about  this 'if'. #}
    <td class="center">
        {% set ci = ci + 1 %}
        {% include 'columns_definitions/column_indexes.twig' with {
            'column_number': column_number,
            'ci': ci,
            'ci_offset': ci_offset,
            'column_meta': column_meta
        } only %}
    </td>
{% endif %}
<td class="center">
    {# column auto_increment #}
    {% set ci = ci + 1 %}
    {% include 'columns_definitions/column_auto_increment.twig' with {
        'column_number': column_number,
        'ci': ci,
        'ci_offset': ci_offset,
        'column_meta': column_meta
    } only %}
</td>
<td class="center">
    {# column comments #}
    {% set ci = ci + 1 %}
    {% include 'columns_definitions/column_comment.twig' with {
        'column_number': column_number,
        'ci': ci,
        'ci_offset': ci_offset,
        'max_length': max_length,
        'value': column_meta['Field'] is defined
            and comments_map is iterable
            and comments_map[column_meta['Field']] is defined
            ? comments_map[column_meta['Field']]|e
    } only %}
</td>
 {# column virtuality #}
{% if is_virtual_columns_supported %}
    <td class="center">
        {% set ci = ci + 1 %}
        {% include 'columns_definitions/column_virtuality.twig' with {
            'column_number': column_number,
            'ci': ci,
            'ci_offset': ci_offset,
            'column_meta': column_meta,
            'char_editing': char_editing,
            'expression': column_meta['Expression'] is defined ? column_meta['Expression'],
            'options': options
        } only %}
    </td>
{% endif %}
{# move column #}
{% if fields_meta is defined %}
    {% set current_index = 0 %}
    {% set cols = move_columns|length - 1 %}
    {% set break = false %}
    {% for mi in 0..cols if move_columns[mi].name == column_meta['Field'] and not break %}
        {% set current_index = mi %}
        {% set break = true %}
    {% endfor %}

    <td class="center">
        {% set ci = ci + 1 %}
        {% include 'columns_definitions/move_column.twig' with {
            'column_number': column_number,
            'ci': ci,
            'ci_offset': ci_offset,
            'column_meta': column_meta,
            'move_columns': move_columns,
            'current_index': current_index
        } only %}
    </td>
{% endif %}

{% if cfg_relation['mimework'] and browse_mime and cfg_relation['commwork'] %}
    <td class="center">
        {# Column Mime-type #}
        {% set ci = ci + 1 %}
        {% include 'columns_definitions/mime_type.twig' with {
            'column_number': column_number,
            'ci': ci,
            'ci_offset': ci_offset,
            'column_meta': column_meta,
            'available_mime': available_mime,
            'mime_map': mime_map
        } only %}
    </td>
    <td class="center">
        {# Column Browser transformation #}
        {% set ci = ci + 1 %}
        {% include 'columns_definitions/transformation.twig' with {
            'column_number': column_number,
            'ci': ci,
            'ci_offset': ci_offset,
            'column_meta': column_meta,
            'available_mime': available_mime,
            'mime_map': mime_map,
            'type': 'transformation'
        } only %}
    </td>
    <td class="center">
        {# column Transformation options #}
        {% set ci = ci + 1 %}
        {% include 'columns_definitions/transformation_option.twig' with {
            'column_number': column_number,
            'ci': ci,
            'ci_offset': ci_offset,
            'column_meta': column_meta,
            'mime_map': mime_map,
            'type_prefix': ''
        } only %}
    </td>
    <td class="center">
        {# Column Input transformation #}
        {% set ci = ci + 1 %}
        {% include 'columns_definitions/transformation.twig' with {
            'column_number': column_number,
            'ci': ci,
            'ci_offset': ci_offset,
            'column_meta': column_meta,
            'available_mime': available_mime,
            'mime_map': mime_map,
            'type': 'input_transformation'
        } only %}
    </td>
    <td class="center">
        {# column Input transformation options #}
        {% set ci = ci + 1 %}
        {% include 'columns_definitions/transformation_option.twig' with {
            'column_number': column_number,
            'ci': ci,
            'ci_offset': ci_offset,
            'column_meta': column_meta,
            'mime_map': mime_map,
            'type_prefix': 'input_'
        } only %}
    </td>
{% endif %}
